<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>
<body>

<h1>POM Admin Test</h1>

<br>
<br>
<form id="loginForm" onsubmit="return false;">
	<input type="text" name="username" value="kkkkkk" />
	<input type="password" name="passwd" value="123qwe!@#" />
	<input type="button" value="Sign In" onclick="signIn(this.form.username.value, this.form.passwd.value)" />
</form>
<div id="login">
    <div id="token">Current token:</div>
</div>
<br>
<br>

<div id="read">
	<a href="#" id="readtest">Read Test</a>
</div>

<div id="create">
	<a href="#" id="createtest">Create Test</a>
</div>

<div id="update">
	<a href="#" id="updatetest">Update Test</a>
</div>

<div id="delete">
	<a href="#" id="deletetest">Delete Test</a>
</div>

<div id="createBatch">
	<a href="#" id="createtestBatch">Create Batch Test</a>
</div>

<br/><br/><br/>
<form onsubmit="return false;">
	<input type="text" name="message" value="" /><input
		type="button" value="Send Web Socket Data"
		onclick="send(this.form.message.value)" />
	<h3>Output</h3>
	<textarea id="responseText" style="width: 500px; height: 300px;"></textarea>
</form>
<script src="./sha256.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript" charset="UTF-8">
	function signIn(argUsername, argPasswd) {
		var payload = {
        		username: argUsername,
        		password: SHA256(argPasswd)
        };
        var url = location.protocol.concat("//", location.host, "/api/newToken");

		var xhr = new XMLHttpRequest();

		xhr.open("POST", url, true);
		xhr.setRequestHeader('Content-type', 'application/json; charset=UTF-8');
		xhr.responseType = "text";
		xhr.onload = function(event) {
			if (xhr.status == 200) {
				console.log(xhr.response);
				$('#token').html('Current Token: ' + xhr.response);
			} else {
				console.log(event);
			}
		}

		xhr.send(JSON.stringify(payload));
	}
    $(document).ready(function () {
    	console.log(SHA256("123qwe!@#"));
        $('#generateToken').on('click', function () {
            /*$.ajax({
                url: '/api/newToken',
                type: 'GET',
                dataType: 'text',
                success: function (text) {
                	console.log(text);
                    $('#token').html('Current Token: ' + text);
                }
            });*/

        });
        
        $('#readtest').on('click', function () {
        	var payload = {
				username: 'kkkkkk'
    		};

        	$.ajax({
        		url: '/api/read',
        		type: 'POST',
        		dataType: 'text',
        		contentType: 'application/json; charset=utf8',
        		data: JSON.stringify(payload),
        		headers: {
                    "Authorization": "Bearer " + $('#token').html().substring(15)
                },
                success: function (text) {
                    console.log(text);
                },
                error: function (err) {
                	var contentType = err.getResponseHeader("content-type");
                	console.log('contentType : ' + contentType);
                    console.log('Error: ' + err.toString());
                    console.log(JSON.parse(err.responseText).error);
                }
        	});
        });
        // createtest
        $('#createtest').on('click', function () {
        	
    		var payload = {
    				sqlName : 'sql_insert_test',
    				data1 : 'aa',
    				data2 : 'bb'
        		};

        	$.ajax({
        		url: '/api/create',
        		type: 'POST',
        		dataType: 'text',
        		contentType: 'application/json; charset=utf8',
        		data: JSON.stringify(payload),
        		headers: {
                    "Authorization": "Bearer " + $('#token').html().substring(15)
                },
                success: function (text) {
                    console.log(text);
                },
                error: function (err) {
                    console.log('Error: ' + err.toString());
                }
        	});
        });
        
     	// update test
        $('#updatetest').on('click', function () {
        	
    		var payload = {
    				sqlName : 'sql_update_test',
    				data1 : 'aa',
    				data2 : 'xxx'
        		};

        	$.ajax({
        		url: '/api/update',
        		type: 'POST',
        		dataType: 'text',
        		contentType: 'application/json; charset=utf8',
        		data: JSON.stringify(payload),
        		headers: {
                    "Authorization": "Bearer " + $('#token').html().substring(15)
                },
                success: function (text) {
                    console.log(text);
                },
                error: function (err) {
                    console.log('Error: ' + err.toString());
                }
        	});
        });
     	
     	// delete test
        $('#deletetest').on('click', function () {
        	
    		var payload = {
    				sqlName : 'sql_delete_test',
    				data1 : 'aa2',
        		};

        	$.ajax({
        		url: '/api/delete',
        		type: 'POST',
        		dataType: 'text',
        		contentType: 'application/json; charset=utf8',
        		data: JSON.stringify(payload),
        		headers: {
                    "Authorization": "Bearer " + $('#token').html().substring(15)
                },
                success: function (text) {
                    console.log(text);
                },
                error: function (err) {
                    console.log('Error: ' + err.toString());
                }
        	});
        });

		$('#createtestBatch').on('click', function () {
        	
    		var payload = {
    				sqlName : "sql_create_batch_test",
    				arr : [
    					{col1:1, col2:"a"},
    					{col1:2, col2:"b"},
    					{col1:3, col2:"c"},
    					{col1:4, col2:"d"},
    					{col1:5, col2:"e"}
    				]
        		};

        	$.ajax({
        		url: '/api/create/multi',
        		type: 'POST',
        		dataType: 'text',
        		contentType: 'application/json; charset=utf8',
        		data: JSON.stringify(payload),
        		headers: {
                    "Authorization": "Bearer " + $('#token').html().substring(15)
                },
                success: function (text) {
                    console.log(text);
                },
                error: function (err) {
                    console.log('Error: ' + err.toString());
                }
        	});
        });
    });
</script>
</body>
</html>
